const btn = document.querySelector(".modal-btn"), overlay = document.querySelector(".overlay"),
  popup = document.querySelector(".callback-form"), close = popup.querySelector(".callback__close"),
  form = popup.querySelector(".callback"), login = popup.querySelector("[name=login]"),
  email = popup.querySelector("[name=email]");
let isStorageSupport = !0, storage = "";
try {
  storage = localStorage.getItem("login")
} catch (a) {
  isStorageSupport = !1
}
btn.addEventListener("click", function (a) {
  a.preventDefault(), popup.classList.add("modal-open"), overlay.classList.add("overlay-open"), storage ? (login.value = storage, email.focus()) : login.focus(), login.focus()
}), close.addEventListener("click", function (a) {
  a.preventDefault(), popup.classList.remove("modal-open"), overlay.classList.remove("overlay-open"), popup.classList.remove("modal-error")
}), form.addEventListener("submit", function (a) {
  login.value && email.value ? isStorageSupport && localStorage.setItem("login", login.value) : (a.preventDefault(), popup.classList.remove("modal-error"), popup.offsetWidth = popup.offsetWidth, popup.classList.add("modal-error"))
}), window.addEventListener("keydown", function (a) {
  27 === a.keyCode && (a.preventDefault(), popup.classList.contains("modal-open") && (popup.classList.remove("modal-open"), overlay.classList.remove("overlay-open"), popup.classList.remove("modal-error")))
}), ymaps.ready(function () {
  const a = new ymaps.Map("map", {center: [59.939173, 30.329326], zoom: 16}, {searchControlProvider: "yandex#search"}),
    b = ymaps.templateLayoutFactory.createClass("<div style=\"color: #FFFFFF; font-weight: bold;\">$[properties.iconContent]</div>"),
    c = new ymaps.Placemark([59.938621, 30.3232], {
      hintContent: "Gllacy - \u043C\u0430\u0433\u0430\u0437\u0438\u043D \u043C\u043E\u0440\u043E\u0436\u0435\u043D\u043E\u0433\u043E",
      balloonContent: "\u0421\u0430\u043C\u043E\u0435 \u0432\u043A\u0443\u0441\u043D\u043E\u0435 \u043C\u043E\u0440\u043E\u0436\u0435\u043D\u043E\u0435 - \u0437\u0434\u0435\u0441\u044C!"
    }, {
      iconLayout: "default#imageWithContent",
      iconImageHref: "img/map-pin.svg",
      iconImageSize: [80, 140],
      iconImageOffset: [-40, -140],
      iconContentLayout: b
    });
  a.geoObjects.add(c)
});
